---
title: Rate Limiter Math
---

Rate Limiter is a configurable fee slope that can charge fees ranging from the configured `base_fee` up to 99% fee (`MAX_FEE`).

## Rate Limiter Formula

The rate limiter uses a progressive fee calculation with the following key components:

Parameters:
- `reference_amount` (x₀): The base reference amount
- `cliff_fee_numerator` (c): The base fee rate
- `fee_increment_bps` (i): The fee increment in basis points
- `max_limiter_duration`: Duration for which the rate limiter is active

The formula depends on the relationship between input_amount and reference_amount:

### Case 1: input_amount ≤ reference_amount

<div align="center">
$$Fee = InputAmount \times c$$
</div>

### Case 2: input_amount > reference_amount

First, decompose the excess amount:

<div align="center">
$$InputAmount = x_0 + (a \times x_0 + b)$$
</div>

where:
- `a`: floor division of (InputAmount - x₀) / x₀
- `b`: remainder of (InputAmount - x₀) mod x₀

Then calculate fees based on whether we exceed the maximum index:

##### If `a < max_index`

<div align="center">
$$Fee = x_0 \times (c + c \times a + i \times a \times (a+1) / 2) + b \times (c + i \times (a+1))$$
</div>

##### If `a ≥ max_index`

<div align="center">
$$d = a - MaxIndex$$
</div>

<div align="center">
$$\small Fee = x_0 \times (c + c \times MaxIndex + i \times MaxIndex \times (MaxIndex+1) / 2) + (d \times x_0 + b) \times MaxFee$$
</div>
